# ds-decomp
Toolkit for decompiling DS games, `dsd` for short. Work in progress, not ready for production yet!

## Contents
- [Goals](#goals)
- [Commands](#commands)
    - [`rom extract`](#rom-extract)
    - [`rom build`](#rom-build)
    - [`init`](#init)
    - [`delink`](#delink)
    - [`dis`](#dis)
    - [`lcf`](#lcf)

## Goals
- Automate decomp project setup with zero user input, saving months of manual setup time.
- Allow developers to easily delink code into individual translation units and to quickly give names to symbols.
- Generate linker scripts with correct link order.
- Integrate with other decompilation tools, including [objdiff](https://github.com/encounter/objdiff).

## Commands

### `rom extract`

Extracts a DS ROM into separate files for code and assets.

```shell
$ dsd rom extract --rom path/to/rom.nds --output--path path/to/extract/
```

Options:
- `-r`, `--rom`: Path to ROM file.
- `-7`, `--arm7-bios`: Path to ARM7 BIOS file, needed for decryption.
- `-o`, `--output-path`: Path to extract directory.

### `rom build`

Builds a DS ROM from an extract directory.

```shell
$ dsd rom build --config path/to/extract/config.yaml --rom path/to/built_rom.nds
```

Options:
- `-c`, `--config`: Path to `config.yaml` in the extract directory.
- `-7`, `--arm7-bios`: Path to ARM7 BIOS file, needed for encryption.
- `-o`, `--rom`: Path to ROM file.

### `init`

Initialize a new `dsd` configuration from a given extract directory generated by [`rom extract`](#rom-extract). This will analyze the code and generate config files.

```shell
$ dsd init --rom-config path/to/extract/config.yaml --output-path path/to/output/
```

Options:
- `-r`, `--rom-config`: Path to `config.yaml` in the extract directory.
- `-o`, `--output-path`: Output path for `dsd` config files.
- `-d`, `--dry`: Dry run, only perform analysis but don't write any files.

### `delink`

Delinks the game into relocatable ELF files.

```shell
$ dsd delink --config-path path/to/config.yaml --elf-path path/to/elfs/
```

Options:
- `-c`, `--config-path`: Path to `config.yaml` generated by [`init`](#init).
- `-e`, `--elf-path`: Output path for ELF files.

### `dis`

Disassembles the game into assembly files. Used for informational purposes, doesn't target a specific assembler.

```shell
$ dsd dis --config-path path/to/config.yaml --asm-path path/to/asm/
```

Options:
- `-c`, `--config-path`: Path to `config.yaml` generated by [`init`](#init).
- `-a`, `--asm-path`: Output path for assembly files.

### `lcf`

Generates a linker command file (LCF) for `mwldarm`.

```shell
$ dsd lcf --config-path path/to/config.yaml --output-path path/to/linker_script.lcf
```

Options:
- `-c`, `--config-path`: Path to `config.yaml` generated by [`init`](#init).
- `-o`, `--output-path`: Output path to LCF file.
